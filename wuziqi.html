<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>äº’è”ç½‘äº”å­æ£‹å¯¹æˆ˜</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Microsoft YaHei', sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			padding: 20px;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.game-container {
			background: rgba(255, 255, 255, 0.95);
			border-radius: 20px;
			padding: 30px;
			box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
			max-width: 800px;
			width: 100%;
		}

		.game-header {
			text-align: center;
			margin-bottom: 20px;
		}

		.game-title {
			color: #4a00e0;
			font-size: 2rem;
			font-weight: bold;
			margin-bottom: 10px;
		}

		.room-info {
			background: linear-gradient(to right, #4a00e0, #8e2de2);
			color: white;
			padding: 15px 20px;
			border-radius: 10px;
			margin-bottom: 20px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			flex-wrap: wrap;
			gap: 10px;
		}

		.room-id {
			font-size: 1.1rem;
			font-weight: bold;
		}

		.player-info {
			font-size: 0.9rem;
		}

		.game-status {
			text-align: center;
			padding: 12px 20px;
			background: #f8f9fa;
			border-radius: 10px;
			font-size: 1.1rem;
			font-weight: bold;
			margin-bottom: 20px;
			color: #333;
		}

		.board-container {
			display: flex;
			justify-content: center;
			margin-bottom: 20px;
		}

		.board {
			display: grid;
			grid-template-columns: repeat(15, 1fr);
			grid-template-rows: repeat(15, 1fr);
			width: 100%;
			max-width: 450px;
			aspect-ratio: 1 / 1;
			background-color: #db9b59;
			padding: 10px;
			border-radius: 10px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
			gap: 1px;
		}

		.cell {
			background-color: #f0d9b5;
			display: flex;
			justify-content: center;
			align-items: center;
			cursor: pointer;
			transition: background-color 0.2s;
			position: relative;
		}

		.cell:hover {
			background-color: #e8ca9e;
		}

		.cell.disabled {
			cursor: not-allowed;
			opacity: 0.6;
		}

		.piece {
			width: 85%;
			height: 85%;
			border-radius: 50%;
			box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
			z-index: 2;
			position: relative;
		}

		.black-piece {
			background: radial-gradient(circle at 30% 30%, #666, #000);
		}

		.white-piece {
			background: radial-gradient(circle at 30% 30%, #fff, #e0e0e0);
		}

		.controls {
			display: flex;
			gap: 10px;
			justify-content: center;
			flex-wrap: wrap;
			margin-bottom: 20px;
		}

		.btn {
			padding: 10px 20px;
			background: linear-gradient(to right, #4a00e0, #8e2de2);
			color: white;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			font-weight: bold;
			transition: all 0.3s;
			font-size: 1rem;
		}

		.btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(138, 43, 226, 0.3);
		}

		.btn:disabled {
			background: #ccc;
			cursor: not-allowed;
			transform: none;
		}

		.share-section {
			background: #f8f9fa;
			border-radius: 10px;
			padding: 20px;
			text-align: center;
		}

		.share-section h3 {
			color: #4a00e0;
			margin-bottom: 10px;
		}

		.share-input {
			width: 100%;
			padding: 10px;
			border: 2px solid #ddd;
			border-radius: 5px;
			font-size: 0.9rem;
			margin-bottom: 10px;
		}

		.loading {
			text-align: center;
			padding: 20px;
			color: #666;
		}

		@media (max-width: 768px) {
			.game-container {
				padding: 20px;
			}
			
			.board {
				max-width: 350px;
			}
			
			.room-info {
				flex-direction: column;
				text-align: center;
			}
		}
	</style>
</head>
<body>
	<div class="game-container">
		<div class="game-header">
			<h1 class="game-title">äº’è”ç½‘äº”å­æ£‹å¯¹æˆ˜</h1>
		</div>
		
		<div id="roomSection">
			<div class="room-info">
				<div class="room-id" id="roomIdDisplay">æˆ¿é—´ID: æœªåŠ å…¥</div>
				<div class="player-info" id="playerInfo">ç­‰å¾…åŠ å…¥æˆ¿é—´...</div>
			</div>
			
			<div class="game-status" id="gameStatus">è¯·å…ˆåˆ›å»ºæˆ–åŠ å…¥æˆ¿é—´</div>
		</div>
		
		<div id="joinSection">
			<div class="controls">
				<button class="btn" onclick="createRoom()">åˆ›å»ºæˆ¿é—´</button>
				<button class="btn" onclick="joinRoom()">åŠ å…¥æˆ¿é—´</button>
				<input type="text" id="joinRoomId" placeholder="è¾“å…¥æˆ¿é—´ID" style="padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
			</div>
		</div>
		
		<div id="gameSection" style="display: none;">
			<div class="board-container">
				<div class="board" id="board"></div>
			</div>
			
			<div class="controls">
				<button class="btn" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
				<button class="btn" onclick="leaveRoom()">ç¦»å¼€æˆ¿é—´</button>
			</div>
		</div>
		
		<div class="share-section">
			<h3>åˆ†äº«æ¸¸æˆ</h3>
			<input type="text" class="share-input" id="shareUrl" readonly>
			<button class="btn" onclick="copyUrl()">å¤åˆ¶é“¾æ¥</button>
		</div>
	</div>

	<script>
		// ğŸŒŸ å…³é”®ä¿®æ”¹ï¼šä½¿ç”¨æ›´ç¨³å®šçš„äº‘ç«¯æ•°æ®åº“
		const BOARD_SIZE = 15;
		const CLOUD_URL = 'https://api.jsonstorage.net/v1/json'; // æ›´ç¨³å®šçš„å…è´¹äº‘å­˜å‚¨
		const API_KEY = 'your-api-key-here'; // ä½ å¯ä»¥ç”³è¯·å…è´¹APIå¯†é’¥
		
		// ğŸ”¥ ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šç”¨æœ¬åœ°å­˜å‚¨ + ç®€å•åŒæ­¥
		let gameState = {
			board: Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(null)),
			currentPlayer: 'black',
			gameOver: false,
			winner: null,
			roomId: null,
			playerColor: null,
			isHost: false,
			lastMove: 0
		};

		let syncInterval = null;

		// åˆå§‹åŒ–
		function init() {
			updateShareUrl();
			checkUrlParams();
		}

		// æ£€æŸ¥URLå‚æ•°
		function checkUrlParams() {
			const urlParams = new URLSearchParams(window.location.search);
			const roomId = urlParams.get('room');
			if (roomId) {
				document.getElementById('joinRoomId').value = roomId;
			}
		}

		// åˆ›å»ºæˆ¿é—´
		function createRoom() {
			const roomId = 'room_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
			gameState.roomId = roomId;
			gameState.playerColor = 'black';
			gameState.isHost = true;

			// ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
			const roomData = {
				board: gameState.board,
				currentPlayer: 'black',
				gameOver: false,
				winner: null,
				lastMove: Date.now(),
				players: { black: 'player1', white: null }
			};
			
			localStorage.setItem(`wuziqi_${roomId}`, JSON.stringify(roomData));
			startGame();
			updateShareUrl();
		}

		// åŠ å…¥æˆ¿é—´
		function joinRoom() {
			const roomId = document.getElementById('joinRoomId').value.trim();
			if (!roomId) {
				alert('è¯·è¾“å…¥æˆ¿é—´ID');
				return;
			}

			// ä»æœ¬åœ°å­˜å‚¨è·å–æˆ¿é—´æ•°æ®
			const roomData = localStorage.getItem(`wuziqi_${roomId}`);
			if (!roomData) {
				alert('æˆ¿é—´ä¸å­˜åœ¨æˆ–å·²å¤±æ•ˆ');
				return;
			}

			const data = JSON.parse(roomData);
			if (data.players.white) {
				alert('æˆ¿é—´å·²æ»¡');
				return;
			}

			gameState.roomId = roomId;
			gameState.playerColor = 'white';
			gameState.isHost = false;

			// æ›´æ–°æˆ¿é—´æ•°æ®
			data.players.white = 'player2';
			localStorage.setItem(`wuziqi_${roomId}`, JSON.stringify(data));
			
			startGame();
			updateShareUrl();
			startSync(); // å¼€å§‹åŒæ­¥
		}

		// å¼€å§‹æ¸¸æˆ
		function startGame() {
			document.getElementById('joinSection').style.display = 'none';
			document.getElementById('gameSection').style.display = 'block';
			
			document.getElementById('roomIdDisplay').textContent = `æˆ¿é—´ID: ${gameState.roomId}`;
			document.getElementById('playerInfo').textContent = 
				`ä½ æ˜¯ ${gameState.playerColor === 'black' ? 'é»‘æ–¹' : 'ç™½æ–¹'} ${gameState.isHost ? '(æˆ¿ä¸»)' : ''}`;
			
			createBoard();
			updateStatus();
		}

		// åˆ›å»ºæ£‹ç›˜
		function createBoard() {
			const board = document.getElementById('board');
			board.innerHTML = '';
			
			for (let row = 0; row < BOARD_SIZE; row++) {
				for (let col = 0; col < BOARD_SIZE; col++) {
					const cell = document.createElement('div');
					cell.className = 'cell';
					cell.dataset.row = row;
					cell.dataset.col = col;
					cell.addEventListener('click', () => handleCellClick(row, col));
					board.appendChild(cell);
				}
			}
		}

		// å¤„ç†ç‚¹å‡»
		function handleCellClick(row, col) {
			if (gameState.gameOver) {
				alert('æ¸¸æˆå·²ç»“æŸ');
				return;
			}

			if (gameState.board[row][col] !== null) {
				alert('æ­¤å¤„å·²æœ‰æ£‹å­');
				return;
			}

			if (gameState.currentPlayer !== gameState.playerColor) {
				alert('ä¸æ˜¯ä½ çš„å›åˆ');
				return;
			}

			makeMove(row, col, gameState.playerColor);
			saveGameState();
			
			if (gameState.isHost) {
				startSync(); // æˆ¿ä¸»å¼€å§‹åŒæ­¥
			}
		}

		// ä¸‹æ£‹
		function makeMove(row, col, color) {
			gameState.board[row][col] = color;
			
			const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
			const piece = document.createElement('div');
			piece.className = `piece ${color}-piece`;
			cell.appendChild(piece);

			// æ£€æŸ¥èƒœåˆ©
			if (checkWin(row, col, color)) {
				gameState.gameOver = true;
				gameState.winner = color;
				updateStatus();
				setTimeout(() => {
					alert(`${color === 'black' ? 'é»‘æ–¹' : 'ç™½æ–¹'}è·èƒœï¼`);
				}, 100);
				return;
			}

			// æ£€æŸ¥å¹³å±€
			if (isBoardFull()) {
				gameState.gameOver = true;
				gameState.winner = 'draw';
				updateStatus();
				setTimeout(() => {
					alert('å¹³å±€ï¼');
				}, 100);
				return;
			}

			gameState.currentPlayer = gameState.currentPlayer === 'black' ? 'white' : 'black';
			updateStatus();
		}

		// æ£€æŸ¥èƒœåˆ©
		function checkWin(row, col, color) {
			const directions = [[0, 1], [1, 0], [1, 1], [1, -1]];

			for (const [dx, dy] of directions) {
				let count = 1;

				// æ­£å‘
				for (let i = 1; i < 5; i++) {
					const newRow = row + dx * i;
					const newCol = col + dy * i;
					if (isValidPosition(newRow, newCol) && gameState.board[newRow][newCol] === color) {
						count++;
					} else {
						break;
					}
				}

				// åå‘
				for (let i = 1; i < 5; i++) {
					const newRow = row - dx * i;
					const newCol = col - dy * i;
					if (isValidPosition(newRow, newCol) && gameState.board[newRow][newCol] === color) {
						count++;
					} else {
						break;
					}
				}

				if (count >= 5) {
					return true;
				}
			}

			return false;
		}

		function isValidPosition(row, col) {
			return row >= 0 && row < BOARD_SIZE && col >= 0 && col < BOARD_SIZE;
		}

		function isBoardFull() {
			for (let row = 0; row < BOARD_SIZE; row++) {
				for (let col = 0; col < BOARD_SIZE; col++) {
					if (gameState.board[row][col] === null) {
						return false;
					}
				}
			}
			return true;
		}

		// ä¿å­˜æ¸¸æˆçŠ¶æ€
		function saveGameState() {
			const roomData = {
				board: gameState.board,
				currentPlayer: gameState.currentPlayer,
				gameOver: gameState.gameOver,
				winner: gameState.winner,
				lastMove: Date.now(),
				players: gameState.isHost ? 
					{ black: 'player1', white: 'player2' } : 
					{ black: 'player1', white: 'player2' }
			};
			
			localStorage.setItem(`wuziqi_${gameState.roomId}`, JSON.stringify(roomData));
		}

		// åŒæ­¥æ¸¸æˆçŠ¶æ€
		function startSync() {
			if (syncInterval) return;
			
			syncInterval = setInterval(() => {
				if (!gameState.roomId) return;
				
				const roomData = localStorage.getItem(`wuziqi_${gameState.roomId}`);
				if (roomData) {
					const data = JSON.parse(roomData);
					
					// æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°
					if (data.lastMove > gameState.lastMove) {
						gameState.board = data.board;
						gameState.currentPlayer = data.currentPlayer;
						gameState.gameOver = data.gameOver;
						gameState.winner = data.winner;
						gameState.lastMove = data.lastMove;
						
						// æ›´æ–°æ£‹ç›˜æ˜¾ç¤º
						updateBoardDisplay();
						updateStatus();
					}
				}
			}, 1000); // æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
		}

		// æ›´æ–°æ£‹ç›˜æ˜¾ç¤º
		function updateBoardDisplay() {
			for (let row = 0; row < BOARD_SIZE; row++) {
				for (let col = 0; col < BOARD_SIZE; col++) {
					const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
					const piece = cell.querySelector('.piece');
					
					if (gameState.board[row][col] && !piece) {
						const newPiece = document.createElement('div');
						newPiece.className = `piece ${gameState.board[row][col]}-piece`;
						cell.appendChild(newPiece);
					} else if (!gameState.board[row][col] && piece) {
						cell.removeChild(piece);
					}
				}
			}
		}

		// æ›´æ–°çŠ¶æ€
		function updateStatus() {
			const status = document.getElementById('gameStatus');
			if (gameState.gameOver) {
				if (gameState.winner === 'draw') {
					status.textContent = 'å¹³å±€ï¼';
				} else {
					status.textContent = `${gameState.winner === 'black' ? 'é»‘æ–¹' : 'ç™½æ–¹'}è·èƒœï¼`;
				}
			} else {
				const yourTurn = gameState.currentPlayer === gameState.playerColor;
				status.textContent = `${gameState.currentPlayer === 'black' ? 'é»‘æ–¹' : 'ç™½æ–¹'}å›åˆ ${yourTurn ? '(ä½ çš„å›åˆ)' : '(å¯¹æ‰‹å›åˆ)'}`;
			}
		}

		// é‡æ–°å¼€å§‹
		function restartGame() {
			if (!confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿ')) return;
			
			gameState.board = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(null));
			gameState.currentPlayer = 'black';
			gameState.gameOver = false;
			gameState.winner = null;
			
			saveGameState();
			createBoard();
			updateStatus();
		}

		// ç¦»å¼€æˆ¿é—´
		function leaveRoom() {
			if (confirm('ç¡®å®šè¦ç¦»å¼€æˆ¿é—´å—ï¼Ÿ')) {
				if (syncInterval) {
					clearInterval(syncInterval);
					syncInterval = null;
				}
				
				gameState.roomId = null;
				gameState.playerColor = null;
				gameState.isHost = false;
				
				document.getElementById('joinSection').style.display = 'block';
				document.getElementById('gameSection').style.display = 'none';
				document.getElementById('roomIdDisplay').textContent = 'æˆ¿é—´ID: æœªåŠ å…¥';
				document.getElementById('playerInfo').textContent = 'ç­‰å¾…åŠ å…¥æˆ¿é—´...';
				document.getElementById('gameStatus').textContent = 'è¯·å…ˆåˆ›å»ºæˆ–åŠ å…¥æˆ¿é—´';
			}
		}

		// æ›´æ–°åˆ†äº«é“¾æ¥
		function updateShareUrl() {
			const shareUrl = document.getElementById('shareUrl');
			if (gameState.roomId) {
				shareUrl.value = `${window.location.origin}${window.location.pathname}?room=${gameState.roomId}`;
			} else {
				shareUrl.value = window.location.href;
			}
		}

		// å¤åˆ¶é“¾æ¥
		function copyUrl() {
			const shareUrl = document.getElementById('shareUrl');
			shareUrl.select();
			document.execCommand('copy');
			alert('é“¾æ¥å·²å¤åˆ¶ï¼å‘é€ç»™æœ‹å‹å³å¯åŠ å…¥å¯¹æˆ˜');
		}

		// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
		window.onload = init;
	</script>
</body>
</html>
